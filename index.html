<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AbsentEase</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        /* Your existing CSS remains the same */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FFFFFF;
        }
        #splash-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000000;
            color: white;
            text-align: center;
        }
        /* ... (keep all other CSS styles the same) ... */
    </style>
</head>
<body>
    <!-- Your existing HTML structure remains the same -->
    <div id="splash-screen">
        <img id="splash-logo" src="https://i.imgur.com/MjL4SlT.png" alt="Logo" style="width: 150px; height: auto; margin-bottom: 10px;">
        <p id="message"></p>
    </div>
    <div id="main-screen">
        <header style="display: flex; align-items: center; padding-left: 10px;">
            <img id="header-logo" src="https://i.imgur.com/WhNJloy.jpeg" alt="Logo" 
                 style="width: 50px; height: auto; margin-right: 20px;">
            <h1 style="margin: 0;">Absentees Sorter</h1>
        </header>

        <div>
            <div class="error-message" id="error-message"></div>
            <select id="class-selector">
                <option value="A2">Class A2</option>
                <option value="B2">Class B2</option>
                <option value="C2">Class C2</option>
                <option value="D2">Class D2</option>
            </select>
            <input type="text" id="roll-input" placeholder="Enter roll numbers (space or comma separated)" />
            <button id="search-btn">Search</button>
            <button id="view-all-btn">View All Students</button>
            <button id="share-btn" style="display: none;">Share</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Roll Number</th>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody id="results-table-body"></tbody>
        </table>
    </div>

    <script>
        // REPLACE WITH YOUR FIREBASE CONFIG (From Firebase Console > Project Settings)
        const firebaseConfig = {
  apiKey: "AIzaSyBBSXDKjH2kk7c8oaMPEZlDPrbi9L4is4",
  authDomain: "cvkm-52da0.firebaseapp.com",
  databaseURL: "https://cvkm-52da0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "cvkm-52da0",
  storageBucket: "cvkm-52da0.appspot.com",
  messagingSenderId: "733824760937",
  appId: "1:733824760937:web:b4522b9c219a0d5ab717e5"
};


        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        document.addEventListener("DOMContentLoaded", function () {
            // Your existing variables
            const splashScreen = document.getElementById("splash-screen");
            const mainScreen = document.getElementById("main-screen");
            const messageEl = document.getElementById("message");
            const errorMessage = document.getElementById("error-message");
            const rollInput = document.getElementById("roll-input");
            const searchBtn = document.getElementById("search-btn");
            const viewAllBtn = document.getElementById("view-all-btn");
            const shareBtn = document.getElementById("share-btn");
            const resultsTableBody = document.getElementById("results-table-body");

            const welcomeMessage = "Welcome To Our App!\n Made by 2023-2025\n CS Batch students.";

            async function fetchClassData(className) {
                try {
                    const snapshot = await database.ref(`classes/${className}`).once('value');
                    const students = snapshot.val();
                    
                    // Remove the first null entry and return
                    return students.filter((student, index) => index !== 0);
                    
                } catch (error) {
                    showError("Failed to load class data. Please try again.");
                    return [];
                }
            }

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = "block";
                setTimeout(() => errorMessage.style.display = "none", 5000);
            }

            // Your existing typeMessage and showMainScreen functions
            function typeMessage(msg, index = 0) {
                if (index < msg.length) {
                    messageEl.textContent += msg[index];
                    setTimeout(() => typeMessage(msg, index + 1), 50);
                } else {
                    setTimeout(() => showMainScreen(), 1000);
                }
            }

            function showMainScreen() {
                splashScreen.style.display = "none";
                mainScreen.style.display = "block";
            }

            function displayStudents(students) {
                resultsTableBody.innerHTML = "";
                students.forEach((student, index) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `<td>${index + 1}</td><td>${student}</td>`;
                    resultsTableBody.appendChild(row);
                });
            }

            // Modified Search Button Click Handler
            searchBtn.addEventListener("click", async () => {
                const input = rollInput.value.trim();
                const selectedClass = document.getElementById("class-selector").value;
                
                if (!input) {
                    showError("Please enter at least one roll number");
                    return;
                }

                const students = await fetchClassData(selectedClass);
                
                // Process roll numbers (1-based index from your database)
                const rollNumbers = input.split(/[\s,]+/).map(num => {
                    const parsed = parseInt(num.trim());
                    return isNaN(parsed) ? null : parsed;
                });

                const errors = [];
                const validStudents = [];
                
                rollNumbers.forEach((roll) => {
                    if (roll === null) {
                        errors.push(`Invalid number: ${roll}`);
                    } else if (roll < 1 || roll > students.length) {
                        errors.push(`Roll ${roll}: Out of range (1-${students.length})`);
                    } else {
                        validStudents.push(students[roll - 1]);
                    }
                });

                if (errors.length > 0) {
                    showError("Invalid input:\n" + errors.join("\n"));
                }

                if (validStudents.length > 0) {
                    displayStudents(validStudents);
                    shareBtn.style.display = "inline-block";
                }
            });

            // Modified View All Button
            viewAllBtn.addEventListener("click", async () => {
                const selectedClass = document.getElementById("class-selector").value;
                const students = await fetchClassData(selectedClass);
                
                if (students.length > 0) {
                    displayStudents(students);
                    shareBtn.style.display = "none";
                }
            });

            // Keep your existing shareBtn click handler
            shareBtn.addEventListener("click", () => {
                const rows = Array.from(resultsTableBody.querySelectorAll("tr"));
                const shareContent = rows.map(row => row.cells[1].textContent).join("\n");
                
                if (navigator.share) {
                    navigator.share({ 
                        title: "Absentees List",
                        text: `Today's Absentees:\n${shareContent}`
                    });
                } else {
                    alert("Sharing not supported - Copy to clipboard instead");
                    navigator.clipboard.writeText(shareContent);
                }
            });

            // Start the app
            typeMessage(welcomeMessage);
        });
    </script>
</body>
</html>
